name: GitHub comment

on:
  workflow_call:
    inputs:
      title:
        required: true
        type: string
      body:
        required: true
        type: string
    secrets:
      github-token:
        required: true

jobs:
  analyze:
    runs-on: ubuntu-latest

    steps:
      - name: Comment
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.github-token }}
          script: |
            // get all comments
            const comments = await github.issues.listComments({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo
            });

            // find the comment that contains the identifier
            const comment = comments.data.find(comment => comment.body.includes(${{ inputs.title }}));

            const output = `
            <details><summary> ${{ inputs.title }}</summary>
            \n
            ${{ inputs.body }}
            `;

            if (comment) {
              // update the comment
              await github.issues.updateComment({
                comment_id: comment.id,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: output
              });
            } else {
              // create a new comment if no matching comment was found
              await github.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: output
              });
            }
